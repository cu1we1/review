#### 正则表达式应用

## 1. 正则表达式匹配时间和日期。

### 时间

> 12:12:01
>
> 01:01:59

分析一下时间的格式：

- 冒号把时间分为了三部分，每一部分都是两个字符，且为 0 也不可以省略。
- 第一部分（时），第一位取值为`[0-2]`,第二位取值`[0-9]`。当第一位为 2 时，第二位只能取`[0-4]`;
- 第二部分（分），第一位取值为`[0-5]`,第二位取值`[0-9]`。
- 第三部分（秒），第一位取值为`[0-5]`,第二位取值`[0-9]`。

根据上面的分析，我们可以得到这样一个正则：

```js
const reg = new RegExp("^([0-1][0-9]|2[0-4]):[0-5][0-9](:[0-5][0-9])?$", "g");
```

### 日期

> yyyy-mm-dd

分析：

- yyyy 每一位取值都是`[0-9]`，当前面全部为 0 时，可以省略，除最后一位。
- mm 第一位取值`[0-1]`,第二位取值`[0-9]`，当且仅当第一位取 1 时，第二位取`[0-2]`
- dd 第一位取值`[0-3]`,第二位取值`[0-9]`，当且仅当第一位取 3 时，第二位取`[0-1]`

我们可以得到：

```js
const reg =
  /^(([1-9]|0?)([1-9]|0?)([1-9]|0?)[0-9])-((1[0-2])|(0[1-9]))-((3[0-1]|0[1-9]|[1-2][0-9]))$/;
```

## 2. 正则提取 url 里面的域名

> https://com.example.quickapp/page?key=value

分析一下 url 都包含什么：

- 分为三部分：协议头+域名+参数
- 以`^(?:https?:\/\/)`开头，并且域名构成为`字母+数字+符号(_-./)`。
- 参数部分可有可无，以`?**=**&**=**`形式存在

可以得到这样一个正则：

```js
const reg = /^(?:https?:\/\/)([a-zA-Z0-9_\-\/.]+)(?:\?\S+)?$/;
```

我们可以用上先行断言和后行断言

```js
const reg = /(?<=(?:^https?:\/\/))([a-zA-Z0-9_\-\/.]+)(?=(?:\?\S+)?$)/;
```

## 3. 正则提取快应用链接里面的快应用包名

> hap://app/com.example.quickapp/page?key=value

分析一下 url 都包含什么：

- 类似上面的 url。
- 快应用链接的包名位于`hap://app/`后面，且`/`之前。

这样很容易：

```js
const reg =
  /^(?:hap:\/\/app\/)([a-zA-Z0-9-_.]+)(?:\/[a-zA-Z0-9-_.]+)*(?:\?\S+)?$/;
```

## 4. 通过正则把钱数改成千位分隔格式。

> 11837573684 改写成 11,837,573,684

分析：

- 数字从右向左三位添加一个英文逗号

然后：

```js
const reg = /(?!\b)(?=(\d{3})+\b)/g;
const reg2 = /\B(?=(\d{3})+\b)/g;
function format(number) {
  return number.replace(reg, ",");
}
```

再来一个支持小数的：

```js
function parseToMoney(num) {
  num = parseFloat(num.toFixed(3));
  let [integer, decimal] = String.prototype.split.call(num, ".");
  integer = integer.replace(/\d(?=(\d{3})+$)/g, "$&,");
  return integer + "." + (decimal ? decimal : "");
}
```

上面的方法，包含一个`replace`的用法：

```
String.prototype.replace(regexp/substr,replacement)
```

replacement 可以是字符串，也可以是函数。如果它是字符串，那么每个匹配都将由字符串替换。但是 replacement 中的 $ 字符具有特定的含义。如下所示：

| 变量名 | 代表的值                                                                                                                                                                                                                             |
| ------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| $$     | 插入一个"$"                                                                                                                                                                                                                          |
| $&     | 插入正则匹配到的字符串                                                                                                                                                                                                               |
| $`     | 插入当前匹配的子串左边的内容                                                                                                                                                                                                         |
| $'     | 插入当前匹配的子串右边的内容                                                                                                                                                                                                         |
| $n     | 假如第一个参数是 RegExp 对象，并且 n 是个小于 100 的非负整数，那么插入第 n 个括号匹配的字符串。提示：索引是从 1 开始。如果不存在第 n 个分组，那么将会把匹配到到内容替换为字面量。比如不存在第 3 个分组，就会用“$3”替换匹配到的内容。 |
